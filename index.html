// Main site setup for "ファビアチェック"
import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Dialog, DialogContent, DialogTrigger } from "@/components/ui/dialog";
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useEffect } from "react";
import axios from "axios";

const TMDB_API_KEY = "9c5b6fe18f36543b858effdaf87e44e0";
const TMDB_BASE_URL = "https://api.themoviedb.org/3";

const PHOBIA_TAGS = [
  "高所", "閉所", "暗所", "蜘蛛", "蝶", "蟻", "昆虫", "蛙", "ヘビ",
  "集合体", "血液描写", "水・溺水", "雷", "嘔吐", "注射・先端",
  "ピエロ", "幽霊・超常現象", "性的シーン", "死体", "その他"
];

export default function FabiaCheck() {
  const [query, setQuery] = useState("");
  const [results, setResults] = useState([]);
  const [popup, setPopup] = useState(false);

  const handleSearch = async () => {
    const res = await axios.get(
      `${TMDB_BASE_URL}/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}`
    );
    setResults(res.data.results);
  };

  useEffect(() => {
    // preload default categories if needed
  }, []);

  return (
    <div className="p-4 space-y-6 bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 min-h-screen">
      {/* Google AdSense */}
      <div dangerouslySetInnerHTML={{
        __html: `<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1387560637754446" crossorigin="anonymous"></script>`
      }} />

      {/* Header */}
      <header className="text-center text-4xl font-bold text-pink-700">ファビアチェック</header>
      <p className="text-center text-sm text-gray-600">ファビオ（恐怖症）要素のある映画を事前チェック</p>

      {/* Site Info and Disclaimer */}
      <div className="flex justify-center gap-4">
        <Dialog>
          <DialogTrigger><Button>サイト説明</Button></DialogTrigger>
          <DialogContent>
            <p>このサイトでは、恐怖症（ファビオ）を持つ方が映画を見る前に恐怖要素をチェックできます。</p>
          </DialogContent>
        </Dialog>
        <Dialog>
          <DialogTrigger><Button>免責事項</Button></DialogTrigger>
          <DialogContent>
            <p>情報はユーザー提供によるもので、正確性を保証するものではありません。自己責任でご利用ください。</p>
          </DialogContent>
        </Dialog>
      </div>

      {/* Search */}
      <div className="flex justify-center gap-2">
        <Input
          placeholder="映画タイトルを検索"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
        />
        <Button onClick={handleSearch}>検索</Button>
      </div>

      {/* Results */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {results.map((movie) => (
          <Card key={movie.id} className="hover:shadow-xl transition">
            <CardContent className="p-2">
              <img src={`https://image.tmdb.org/t/p/w300${movie.poster_path}`} alt={movie.title} className="rounded-lg" />
              <div className="text-lg font-semibold mt-2">{movie.title}</div>
              <div className="text-sm text-gray-600">{movie.release_date}</div>
              {/* Placeholder for phobia tags + user input */}
              <div className="mt-2 text-sm">恐怖要素: 未登録</div>
              <Button className="mt-2 w-full" variant="outline">要素を追加/修正</Button>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Placeholder Tabs */}
      <Tabs defaultValue="now_playing">
        <TabsList className="grid grid-cols-2 md:grid-cols-4 gap-2">
          <TabsTrigger value="upcoming">公開予定の映画</TabsTrigger>
          <TabsTrigger value="now_playing">上映中の映画</TabsTrigger>
          <TabsTrigger value="popular">話題の映画</TabsTrigger>
          <TabsTrigger value="top_rated">評価の高い映画</TabsTrigger>
        </TabsList>
        {/* You'd add matching <TabsContent /> for each tab with similar fetching logic as handleSearch */}
      </Tabs>
    </div>
  );
}
