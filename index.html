import React, { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Checkbox } from '@/components/ui/checkbox';
import { Textarea } from '@/components/ui/textarea';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';

const API_KEY = '9c5b6fe18f36543b858effdaf87e44e0';
const PHOBIAS = [
  '高所', '閉所', '暗所', '蜘蛛', '蝶', '蟻', '昆虫', '蛙', 'ヘビ',
  '集合体', '血液描写', '水・溺水', '雷', '嘔吐', '注射・先端',
  'ピエロ', '幽霊・超常現象', '性的シーン', '死体', 'その他'
];

function App() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [selectedPhobias, setSelectedPhobias] = useState([]);
  const [otherText, setOtherText] = useState('');
  const [time, setTime] = useState('');
  const [details, setDetails] = useState('');
  const [category, setCategory] = useState('now_playing');
  const [movies, setMovies] = useState([]);

  const fetchMovies = async (type) => {
    const res = await fetch(`https://api.themoviedb.org/3/movie/${type}?api_key=${API_KEY}&language=ja-JP&page=1`);
    const data = await res.json();
    setMovies(data.results);
  };

  useEffect(() => {
    fetchMovies(category);
  }, [category]);

  const handleSearch = async () => {
    const res = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&language=ja-JP&query=${query}`);
    const data = await res.json();
    setResults(data.results);
  };

  const togglePhobia = (phobia) => {
    setSelectedPhobias(prev =>
      prev.includes(phobia) ? prev.filter(p => p !== phobia) : [...prev, phobia]
    );
  };

  return (
    <div className="p-6 font-sans bg-gradient-to-br from-pink-100 to-yellow-100 min-h-screen">
      <h1 className="text-4xl font-bold text-center text-pink-700 mb-6">ファビアチェック</h1>
      <p className="text-center mb-4">ファビオ（恐怖症）を事前にチェックできる映画紹介サイト</p>

      <div className="mb-6 flex justify-center gap-2">
        <Input value={query} onChange={e => setQuery(e.target.value)} placeholder="映画タイトル検索" />
        <Button onClick={handleSearch}>検索</Button>
      </div>

      {results.length > 0 && (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {results.slice(0, 8).map(movie => (
            <Card key={movie.id}><CardContent>{movie.title}</CardContent></Card>
          ))}
        </div>
      )}

      <Tabs defaultValue={category} onValueChange={setCategory} className="mt-10">
        <TabsList className="grid grid-cols-4">
          <TabsTrigger value="upcoming">公開予定</TabsTrigger>
          <TabsTrigger value="now_playing">上映中</TabsTrigger>
          <TabsTrigger value="popular">話題</TabsTrigger>
          <TabsTrigger value="top_rated">高評価</TabsTrigger>
        </TabsList>
        <TabsContent value={category}>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {movies.slice(0, 8).map(movie => (
              <Card key={movie.id}><CardContent>{movie.title}</CardContent></Card>
            ))}
          </div>
        </TabsContent>
      </Tabs>

      <div className="mt-10 p-4 bg-white rounded-2xl shadow">
        <h2 className="text-xl font-bold mb-4">恐怖要素の追加・修正フォーム</h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
          {PHOBIAS.map(phobia => (
            <label key={phobia} className="flex items-center">
              <Checkbox checked={selectedPhobias.includes(phobia)} onCheckedChange={() => togglePhobia(phobia)} />
              <span className="ml-2">{phobia}</span>
            </label>
          ))}
        </div>
        {selectedPhobias.includes('その他') && (
          <Textarea placeholder="その他の恐怖要素" value={otherText} onChange={e => setOtherText(e.target.value)} className="mb-4" />
        )}
        <Input placeholder="出現時間（例：00:23:15）" value={time} onChange={e => setTime(e.target.value)} className="mb-4" />
        <Textarea placeholder="詳細（任意）" value={details} onChange={e => setDetails(e.target.value)} className="mb-4" />
        <Button>送信</Button>
      </div>

      <footer className="text-center text-sm text-gray-600 mt-10">
        <p>本サイトは恐怖症を持つ方が映画を安心して楽しめることを目的としています。</p>
        <p>免責事項・プライバシーポリシー・運営者情報・お問い合わせフォームは別途ページをご確認ください。</p>
        <p>この製品は TMDB API を使用していますが、TMDB によって承認または認可されているわけではありません。</p>
        <div className="mt-4">
          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1387560637754446" crossOrigin="anonymous"></script>
        </div>
      </footer>
    </div>
  );
}

export default App;
